<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blog Platform</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f6f9;
    }

    .navbar-brand {
      font-weight: 600;
    }

    .card {
      border: none;
      border-radius: 12px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.08);
    }

    textarea {
      resize: none;
    }
  </style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark mb-4">
  <div class="container">
    <span class="navbar-brand">üìù Blog Platform</span>
  </div>
</nav>

<div class="container">

  <div class="card mb-5">
    <div class="card-body p-4">
      <h4 class="mb-3">Create a new post</h4>

      <div class="row g-3">
        <div class="col-md-6">
          <input id="title" class="form-control" placeholder="Title">
        </div>
        <div class="col-md-6">
          <input id="author" class="form-control" placeholder="Author (optional)">
        </div>
        <div class="col-12">
          <textarea id="body" rows="4" class="form-control" placeholder="Write your post..."></textarea>
        </div>
      </div>

      <button onclick="createBlog()" class="btn btn-primary mt-4 w-100">
        Publish
      </button>
    </div>
  </div>

  <div class="row" id="blogs"></div>

</div>

<script>
  const API = "http://localhost:3000/blogs";

  async function fetchBlogs() {
    const res = await fetch(API);
    const blogs = await res.json();

    const container = document.getElementById("blogs");
    container.innerHTML = "";

    blogs.reverse().forEach(blog => {
      const col = document.createElement("div");
      col.className = "col-md-6 col-lg-4 mb-4";

      col.innerHTML = `
        <div class="card h-100">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">
            <a href="/${blog._id}" class="text-decoration-none">
                ${blog.title}
            </a>
            </h5>
            <h6 class="card-subtitle mb-2 text-muted">
              ${blog.author || "Anonymous"}
            </h6>
            <p class="card-text flex-grow-1">
              ${blog.body}
            </p>
            <button class="btn btn-outline-primary btn-sm me-2"
            onclick="openEditModal('${blog._id}', '${blog.title}', '${blog.author}', '${blog.body}')">
            Edit
            </button>

            <button class="btn btn-outline-danger btn-sm"
            onclick="deleteBlog('${blog._id}')">
            Delete
            </button>

          </div>
        </div>
      `;

      container.appendChild(col);
    });
  }

  async function createBlog() {
    const title = document.getElementById("title").value.trim();
    const body = document.getElementById("body").value.trim();
    const author = document.getElementById("author").value.trim();

    if (!title || !body) {
      alert("Title and body are required");
      return;
    }

    await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, body, author })
    });

    document.getElementById("title").value = "";
    document.getElementById("body").value = "";
    document.getElementById("author").value = "";

    fetchBlogs();
  }

  async function deleteBlog(id) {
    await fetch(`${API}/${id}`, { method: "DELETE" });
    fetchBlogs();
  }

  fetchBlogs();
</script>


<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Blog</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="editTitle" class="form-control mb-2" placeholder="Title">
        <input id="editAuthor" class="form-control mb-2" placeholder="Author">
        <textarea id="editBody" class="form-control" rows="4"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" onclick="updateBlog()">Save changes</button>
      </div>
    </div>
  </div>
</div>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
></script>


<script>
  let currentBlogId = null;

  function openEditModal(id, title, author, body) {
    currentBlogId = id;

    document.getElementById("editTitle").value = title;
    document.getElementById("editAuthor").value = author;
    document.getElementById("editBody").value = body;

    const modal = new bootstrap.Modal(document.getElementById("editModal"));
    modal.show();
  }

  async function updateBlog() {
    const title = document.getElementById("editTitle").value.trim();
    const body = document.getElementById("editBody").value.trim();
    const author = document.getElementById("editAuthor").value.trim();

    if (!title || !body) {
      alert("Title and body are required");
      return;
    }

    await fetch(`${API}/${currentBlogId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, body, author })
    });

    bootstrap.Modal.getInstance(
      document.getElementById("editModal")
    ).hide();

    fetchBlogs();
  }
</script>


</body>
</html>
